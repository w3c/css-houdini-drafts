<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>CSS Animation Worklet API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: normal;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version 977818befb9e8ed77b00b31e184be9cac1dc0922" name="generator">
  <link href="https://wicg.github.io/animation-worklet/" rel="canonical">
<style>/* style-md-lists */

            /* This is a weird hack for me not yet following the commonmark spec
               regarding paragraph and lists. */
            [data-md] > :first-child {
                margin-top: 0;
            }
            [data-md] > :last-child {
                margin-bottom: 0;
            }</style>
<style>/* style-selflinks */

            .heading, .issue, .note, .example, li, dt {
                position: relative;
            }
            a.self-link {
                position: absolute;
                top: 0;
                left: calc(-1 * (3.5rem - 26px));
                width: calc(3.5rem - 26px);
                height: 2em;
                text-align: center;
                border: none;
                transition: opacity .2s;
                opacity: .5;
            }
            a.self-link:hover {
                opacity: 1;
            }
            .heading > a.self-link {
                font-size: 83%;
            }
            li > a.self-link {
                left: calc(-1 * (3.5rem - 26px) - 2em);
            }
            dfn > a.self-link {
                top: auto;
                left: auto;
                opacity: 0;
                width: 1.5em;
                height: 1.5em;
                background: gray;
                color: white;
                font-style: normal;
                transition: opacity .2s, background-color .2s, color .2s;
            }
            dfn:hover > a.self-link {
                opacity: 1;
            }
            dfn > a.self-link:hover {
                color: black;
            }

            a.self-link::before            { content: "¶"; }
            .heading > a.self-link::before { content: "§"; }
            dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

            body {
                counter-reset: example figure issue;
            }
            .issue {
                counter-increment: issue;
            }
            .issue:not(.no-marker)::before {
                content: "Issue " counter(issue);
            }

            .example {
                counter-increment: example;
            }
            .example:not(.no-marker)::before {
                content: "Example " counter(example);
            }
            .invalid.example:not(.no-marker)::before,
            .illegal.example:not(.no-marker)::before {
                content: "Invalid Example" counter(example);
            }

            figcaption {
                counter-increment: figure;
            }
            figcaption:not(.no-marker)::before {
                content: "Figure " counter(figure) " ";
            }</style>
<style>/* style-autolinks */

            .css.css, .property.property, .descriptor.descriptor {
                color: #005a9c;
                font-size: inherit;
                font-family: inherit;
            }
            .css::before, .property::before, .descriptor::before {
                content: "‘";
            }
            .css::after, .property::after, .descriptor::after {
                content: "’";
            }
            .property, .descriptor {
                /* Don't wrap property and descriptor names */
                white-space: nowrap;
            }
            .type { /* CSS value <type> */
                font-style: italic;
            }
            pre .property::before, pre .property::after {
                content: "";
            }
            [data-link-type="property"]::before,
            [data-link-type="propdesc"]::before,
            [data-link-type="descriptor"]::before,
            [data-link-type="value"]::before,
            [data-link-type="function"]::before,
            [data-link-type="at-rule"]::before,
            [data-link-type="selector"]::before,
            [data-link-type="maybe"]::before {
                content: "‘";
            }
            [data-link-type="property"]::after,
            [data-link-type="propdesc"]::after,
            [data-link-type="descriptor"]::after,
            [data-link-type="value"]::after,
            [data-link-type="function"]::after,
            [data-link-type="at-rule"]::after,
            [data-link-type="selector"]::after,
            [data-link-type="maybe"]::after {
                content: "’";
            }

            [data-link-type].production::before,
            [data-link-type].production::after,
            .prod [data-link-type]::before,
            .prod [data-link-type]::after {
                content: "";
            }

            [data-link-type=element],
            [data-link-type=element-attr] {
                font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
                font-size: .9em;
            }
            [data-link-type=element]::before { content: "<" }
            [data-link-type=element]::after  { content: ">" }

            [data-link-type=biblio] {
                white-space: pre;
            }</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
        .highlight:not(.idl) { background: hsl(24, 20%, 95%); }
        code.highlight { padding: .1em; border-radius: .3em; }
        pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
        .highlight .c { color: #708090 } /* Comment */
        .highlight .k { color: #990055 } /* Keyword */
        .highlight .l { color: #000000 } /* Literal */
        .highlight .n { color: #0077aa } /* Name */
        .highlight .o { color: #999999 } /* Operator */
        .highlight .p { color: #999999 } /* Punctuation */
        .highlight .cm { color: #708090 } /* Comment.Multiline */
        .highlight .cp { color: #708090 } /* Comment.Preproc */
        .highlight .c1 { color: #708090 } /* Comment.Single */
        .highlight .cs { color: #708090 } /* Comment.Special */
        .highlight .kc { color: #990055 } /* Keyword.Constant */
        .highlight .kd { color: #990055 } /* Keyword.Declaration */
        .highlight .kn { color: #990055 } /* Keyword.Namespace */
        .highlight .kp { color: #990055 } /* Keyword.Pseudo */
        .highlight .kr { color: #990055 } /* Keyword.Reserved */
        .highlight .kt { color: #990055 } /* Keyword.Type */
        .highlight .ld { color: #000000 } /* Literal.Date */
        .highlight .m { color: #000000 } /* Literal.Number */
        .highlight .s { color: #a67f59 } /* Literal.String */
        .highlight .na { color: #0077aa } /* Name.Attribute */
        .highlight .nc { color: #0077aa } /* Name.Class */
        .highlight .no { color: #0077aa } /* Name.Constant */
        .highlight .nd { color: #0077aa } /* Name.Decorator */
        .highlight .ni { color: #0077aa } /* Name.Entity */
        .highlight .ne { color: #0077aa } /* Name.Exception */
        .highlight .nf { color: #0077aa } /* Name.Function */
        .highlight .nl { color: #0077aa } /* Name.Label */
        .highlight .nn { color: #0077aa } /* Name.Namespace */
        .highlight .py { color: #0077aa } /* Name.Property */
        .highlight .nt { color: #669900 } /* Name.Tag */
        .highlight .nv { color: #222222 } /* Name.Variable */
        .highlight .ow { color: #999999 } /* Operator.Word */
        .highlight .mb { color: #000000 } /* Literal.Number.Bin */
        .highlight .mf { color: #000000 } /* Literal.Number.Float */
        .highlight .mh { color: #000000 } /* Literal.Number.Hex */
        .highlight .mi { color: #000000 } /* Literal.Number.Integer */
        .highlight .mo { color: #000000 } /* Literal.Number.Oct */
        .highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
        .highlight .sc { color: #a67f59 } /* Literal.String.Char */
        .highlight .sd { color: #a67f59 } /* Literal.String.Doc */
        .highlight .s2 { color: #a67f59 } /* Literal.String.Double */
        .highlight .se { color: #a67f59 } /* Literal.String.Escape */
        .highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
        .highlight .si { color: #a67f59 } /* Literal.String.Interpol */
        .highlight .sx { color: #a67f59 } /* Literal.String.Other */
        .highlight .sr { color: #a67f59 } /* Literal.String.Regex */
        .highlight .s1 { color: #a67f59 } /* Literal.String.Single */
        .highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
        .highlight .vc { color: #0077aa } /* Name.Variable.Class */
        .highlight .vg { color: #0077aa } /* Name.Variable.Global */
        .highlight .vi { color: #0077aa } /* Name.Variable.Instance */
        .highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
        </style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">CSS Animation Worklet API</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Community Group Report, <time class="dt-updated" datetime="2017-04-19">19 April 2017</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/animation-worklet/">https://wicg.github.io/animation-worklet/</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/animation-worklet/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:majidvp@google.com">Majid Valipour</a>
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:flackr@chromium.org">Robert Flack</a>
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:smcgruer@chromium.org">Stephen McGruer</a>
     <dd class="editor p-author h-card vcard"><span class="p-name fn"></span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2015 the Contributors to the CSS Animation Worklet API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#animation-worklet-desc"><span class="secno">2</span> <span class="content">Animation Worklet</span></a>
    <li><a href="#concepts"><span class="secno">3</span> <span class="content">Concepts</span></a>
    <li><a href="#registering-animator-definition"><span class="secno">4</span> <span class="content">Registering an Animator Definition</span></a>
    <li><a href="#creating-animator"><span class="secno">5</span> <span class="content">Creating an Animator</span></a>
    <li><a href="#creating-element-proxy"><span class="secno">6</span> <span class="content">Creating an Element Proxy</span></a>
    <li>
     <a href="#requesting-animation-frames"><span class="secno">7</span> <span class="content">Requesting Animation Frames</span></a>
     <ol class="toc">
      <li><a href="#requesting-animation-frames-element-proxy"><span class="secno">7.1</span> <span class="content">Element proxy creation/removal</span></a>
      <li><a href="#requesting-animation-frames-computed-style"><span class="secno">7.2</span> <span class="content">Change in an element’s computed style</span></a>
      <li><a href="#requesting-animation-frames-document-timeline"><span class="secno">7.3</span> <span class="content">Animator specifies a DocumentTimeline</span></a>
      <li><a href="#requesting-animation-frames-scroll-timeline"><span class="secno">7.4</span> <span class="content">Animator specifies a ScrollTimeline</span></a>
     </ol>
    <li><a href="#running-animators"><span class="secno">8</span> <span class="content">Running Animators</span></a>
    <li><a href="#closing-animator"><span class="secno">9</span> <span class="content">Closing an Animator</span></a>
    <li><a href="#css-animator-notation"><span class="secno">10</span> <span class="content">CSS Animator Notation</span></a>
    <li><a href="#effect-stack"><span class="secno">11</span> <span class="content">Effect Stack</span></a>
    <li><a href="#security-considerations"><span class="secno">12</span> <span class="content">Security Considerations</span></a>
    <li><a href="#privacy-considerations"><span class="secno">13</span> <span class="content">Privacy Considerations</span></a>
    <li>
     <a href="#examples"><span class="secno">14</span> <span class="content">Examples</span></a>
     <ol class="toc">
      <li><a href="#example-1"><span class="secno">14.1</span> <span class="content">Example 1: A fade-in animation with spring timing.</span></a>
      <li><a href="#example-2"><span class="secno">14.2</span> <span class="content">Example 2: Twitter header.</span></a>
      <li><a href="#example-3"><span class="secno">14.3</span> <span class="content">Example 3: Parallax backgrounds.</span></a>
     </ol>
    <li><a href="#conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#property-index"><span class="secno"></span> <span class="content">Property Index</span></a>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    This document introduces a new primitive for creating scroll-linked and other high performance
procedural animations on the web. For details on the rationale and motivation see <a data-link-type="biblio" href="#biblio-explainer">[explainer]</a>. 
   <p>The <a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet-1">Animation Worklet</a> provides a method to create scripted animations that can mutate a set
of user visible animatable attributes. The API is designed to make it possible for such animations to
run in performance-critical parts of the rendering pipeline. Although the specification does not
require certain performance guarantees (e.g., running in sync with every frame produced or in
isolation from main thread) but the API is designed to facilitate and encourage this.</p>
   <p><strong>Relationship to Web Animation API</strong>: Animations running on <a data-link-type="dfn" href="#animation-worklet" id="ref-for-animation-worklet-2">Animation
Worklet</a> do not necessarily run on the main thread and thus are not synchronized with <a data-link-type="dfn" href="https://www.w3.org/TR/web-animations/#the-documents-default-timeline">default
document timeline</a>. At the moment we do not expose any API to start, stop, compose or otherwise
control these animations from outside the worklet, however our plan is to leverage existing web
animation APIs such as Element::getAnimations().</p>
   <p class="note" role="note"><span>Note:</span> <strong>Access to input</strong>: We are interested on exposing additional user input (e.g.,
scrolling input) to these animations so that authors can create jank-free input driven animations
which are not really possible today.</p>
   <p class="note" role="note"><span>Note:</span> <strong>Threading Model</strong>: The API is designed to allow animation worklets to run on
threads other  than the main thread. In particular, it is recommended that if it is possible to run
them in a dedicated thread and  provide a best-effort attempt to run in sync with visual frame
production. This ensures the animations will not be impacted by jank on main thread.
This means that when querying those animations running on the worklet in main thread, the data may
be staled until such time that the animation effects are synced back to main thread (Not dissimilar
to how async scrolling can lead to stale scroll offsets).
It is still possible for such animation to slip in relation with visual frame production if
*animate* callback cannot be completed in time. We believe such slippage is going to be rare in
particular if animators are running on their dedicated thread and the effect avoid layout inducing
attributes.</p>
   <h2 class="heading settled" data-level="2" id="animation-worklet-desc"><span class="secno">2. </span><span class="content">Animation Worklet</span><a class="self-link" href="#animation-worklet-desc"></a></h2>
    <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animation-worklet">Animation Worklet</dfn> is a <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/worklets/#worklet">Worklet</a></code> responsible for all classes related to custom
animations. The worklet can be accessed via <code class="idl"><a data-link-type="idl" href="#dom-window-animationworklet" id="ref-for-dom-window-animationworklet-1">animationWorklet</a></code> attribute. 
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-window-animationworklet" id="ref-for-dom-window-animationworklet-2">animationWorklet</a></code>'s <a data-link-type="dfn" href="https://drafts.css-houdini.org/worklets/#worklet-global-scope-type">worklet global scope type</a> is <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope-1">AnimationWorkletGlobalScope</a></code>.</p>
<pre class="idl highlight def"><span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="animationworklet">AnimationWorklet</dfn> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">void</span>> <dfn class="nv idl-code" data-dfn-for="AnimationWorklet" data-dfn-type="method" data-export="" data-lt="import(moduleURL)" id="dom-animationworklet-import">import<a class="self-link" href="#dom-animationworklet-import"></a></dfn>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><span class="kt">USVString</span></a> <dfn class="nv idl-code" data-dfn-for="AnimationWorklet/import(moduleURL)" data-dfn-type="argument" data-export="" id="dom-animationworklet-import-moduleurl-moduleurl">moduleURL<a class="self-link" href="#dom-animationworklet-import-moduleurl-moduleurl"></a></dfn>);
};

<span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/browsers.html#window">Window</a> {
    [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#animationworklet" id="ref-for-animationworklet-1">AnimationWorklet</a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="attribute" data-export="" data-readonly="" data-type="AnimationWorklet" id="dom-window-animationworklet">animationWorklet</dfn>;
};
</pre>
<pre class="idl highlight def"><span class="kt">callback</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="callback" data-export="" id="callbackdef-voidfunction">VoidFunction</dfn> = <span class="kt">void</span> ();

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=<span class="n">AnimationWorklet</span>]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="animationworkletglobalscope">AnimationWorkletGlobalScope</dfn> : <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#workletglobalscope">WorkletGlobalScope</a> {
    <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator-1">registerAnimator</a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="AnimationWorkletGlobalScope/registerAnimator(name, animatorCtor)" data-dfn-type="argument" data-export="" id="dom-animationworkletglobalscope-registeranimator-name-animatorctor-name">name<a class="self-link" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"></a></dfn>, <a class="n" data-link-type="idl-name" href="#callbackdef-voidfunction" id="ref-for-callbackdef-voidfunction-1">VoidFunction</a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="AnimationWorkletGlobalScope/registerAnimator(name, animatorCtor)" data-dfn-type="argument" data-export="" id="dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor">animatorCtor</dfn>);
};
</pre>
   <div class="note" role="note">
     Note: This is how the class should look. 
<pre class="lang-javascript highlight"><span class="kr">class</span> FooAnimator <span class="p">{</span>
    <span class="kr">static</span> get elements<span class="p">(</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">{</span>name<span class="o">:</span> <span class="s1">'foo'</span><span class="p">,</span> inputProperties<span class="o">:</span> <span class="p">[</span><span class="s1">'--foo'</span><span class="p">]</span><span class="p">,</span> outputProperties<span class="o">:</span> <span class="p">[</span><span class="p">]</span><span class="p">}</span><span class="p">,</span>
            <span class="p">{</span>name<span class="o">:</span> <span class="s1">'bar'</span><span class="p">,</span> inputProperties<span class="o">:</span> <span class="p">[</span><span class="p">]</span><span class="p">,</span> outputProperties<span class="o">:</span> <span class="p">[</span><span class="s1">'transform'</span><span class="p">]</span><span class="p">}</span><span class="p">,</span>
        <span class="p">]</span><span class="p">;</span>
    <span class="p">}</span><span class="p">;</span>

    <span class="kr">static</span> timelines <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'document'</span><span class="p">,</span>
        <span class="p">{</span> type<span class="o">:</span> <span class="s1">'scroll'</span><span class="p">,</span> <span class="p">{</span> orientation<span class="o">:</span> <span class="s1">'vertical'</span> <span class="p">}</span> <span class="p">}</span><span class="p">,</span>
    <span class="p">]</span><span class="p">;</span>

    animate<span class="p">(</span>elementMap<span class="p">,</span> timelines<span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Animation frame logic goes here
</span>    <span class="p">}</span>
<span class="p">}</span>
</pre>
   </div>
   <h2 class="heading settled" data-level="3" id="concepts"><span class="secno">3. </span><span class="content">Concepts</span><a class="self-link" href="#concepts"></a></h2>
    A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-definition">animator definition</dfn> describes an author defined animation which can be referenced by
an <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-1">animator instance</a>. It consists of: 
   <ul>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="class-constructor">class constructor</dfn>.</p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animate-function">animate function</dfn>.</p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-slot-list">animator slot list</dfn> containing a dictionary providing each <dfn data-dfn-type="dfn" data-noexport="" id="slot-name">slot name<a class="self-link" href="#slot-name"></a></dfn>,
its <dfn data-dfn-type="dfn" data-noexport="" id="input-property-list">input property list<a class="self-link" href="#input-property-list"></a></dfn>, and its <dfn data-dfn-type="dfn" data-noexport="" id="output-property-list">output property list<a class="self-link" href="#output-property-list"></a></dfn>.</p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-timeline-options-list">animator timeline options list</dfn>.</p>
   </ul>
   <p>Each entry in the <a data-link-type="dfn" href="#animator-slot-list" id="ref-for-animator-slot-list-1">animator slot list</a> consists of:</p>
   <ul>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-slot">animator slot</dfn> <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident">&lt;ident></a>#.</p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-input-property-list">animator input property list</dfn>.</p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-output-property-list">animator output property list</dfn>.</p>
   </ul>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-instance">animator instance</dfn> describes a fully realized custom animation instance in the worklet
context and links an <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definition-1">animator definition</a> with the instance specific state such as its element
proxies. It consists of:</p>
   <ul>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-name">animator name</dfn> <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident">&lt;ident></a>#.</p>
    <li data-md="">
     <p>An <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag-1">animation requested flag</a>.</p>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="root-element">root element</dfn>.</p>
    <li data-md="">
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="element-proxy-map">element proxy map</dfn> mapping <a data-link-type="dfn" href="#animator-slot" id="ref-for-animator-slot-1">animator slot</a> to a list of <a data-link-type="dfn" href="#element-proxy" id="ref-for-element-proxy-1">element proxies</a>.</p>
   </ul>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="element-proxy">element proxy</dfn> defines a handle to an element which can be used to read or
write its explicitly exposed animatable attributes. It consists of:</p>
   <ul>
    <li data-md="">
     <p>An <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-2">animator instance</a>.</p>
    <li data-md="">
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="proxied-element">proxied element</dfn>.</p>
    <li data-md="">
     <p>A read only map of proxied input properties to their values.</p>
    <li data-md="">
     <p>A map of proxied output properties to their values.</p>
   </ul>
   <h2 class="heading settled" data-level="4" id="registering-animator-definition"><span class="secno">4. </span><span class="content">Registering an Animator Definition</span><a class="self-link" href="#registering-animator-definition"></a></h2>
    The <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope-2">AnimationWorkletGlobalScope</a></code> has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animator-name-to-animator-definition-map">animator name to animator definition map</dfn>.
The map gets populated when <code class="idl"><a data-link-type="idl" href="#dom-animationworkletglobalscope-registeranimator" id="ref-for-dom-animationworkletglobalscope-registeranimator-2">registerAnimator(name, animatorCtor)</a></code> is called. 
   <p>When the <dfn class="dfn-paneled idl-code" data-dfn-for="AnimationWorkletGlobalScope" data-dfn-type="method" data-export="" data-lt="registerAnimator(name, animatorCtor)" id="dom-animationworkletglobalscope-registeranimator">registerAnimator(<var>name</var>, <var>animatorCtor</var>)</dfn> method is called, the user agent <em>must</em> run the following steps:</p>
   <ol>
    <li data-md="">
     <p>If the <var>name</var> is not a valid <a class="production css" data-link-type="type" href="https://drafts.csswg.org/css-values-4/#typedef-ident">&lt;ident></a>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror">TypeError</a> and abort all these
steps.</p>
    <li data-md="">
     <p>If the <var>name</var> exists as a key in the <a data-link-type="dfn" href="#animator-name-to-animator-definition-map" id="ref-for-animator-name-to-animator-definition-map-1">animator name to animator definition map</a>, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#notsupportederror">NotSupportedError</a> and abort all these steps.</p>
    <li data-md="">
     <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-isconstructor">IsConstructor</a>(<var>animatorCtor</var>) is false, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror">TypeError</a> and abort all these steps.</p>
    <li data-md="">
     <p>Let <var>prototype</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p">Get</a>(<var>animatorCtor</var>, "prototype").</p>
    <li data-md="">
     <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values">Type</a>(<var>prototype</var>) is not Object, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror">TypeError</a> and abort all these steps.</p>
    <li data-md="">
     <p>Let <var>animate</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p">Get</a>(<var>prototype</var>, "animate").</p>
    <li data-md="">
     <p>If the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-iscallable">IsCallable</a>(<var>animate</var>) is false, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror">TypeError</a> and
abort all these steps.</p>
    <li data-md="">
     <p>Let <var>elements</var> be the result of <a data-link-type="dfn" href="#parsing-an-animator-slot-list" id="ref-for-parsing-an-animator-slot-list-1">parsing an animator slot list</a> for <var>animatorCtor</var>.
If an exception is thrown, rethrow the exception and abort all these steps.</p>
    <li data-md="">
     <p>Let <var>timelineOptions</var> be the result of <a data-link-type="dfn" href="#parsing-an-animator-timeline-options-list" id="ref-for-parsing-an-animator-timeline-options-list-1">parsing an animator timeline options list</a> for <var>animatorCtor</var>. If an exception is thrown, rethrow the exception and abort all these steps.</p>
    <li data-md="">
     <p>Let <var>definition</var> be a new <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definition-2">animator definition</a> with:</p>
     <ul>
      <li data-md="">
       <p><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-1">animator name</a> being <var>name</var></p>
      <li data-md="">
       <p><a data-link-type="dfn" href="#class-constructor" id="ref-for-class-constructor-1">class constructor</a> being <var>animatorCtor</var></p>
      <li data-md="">
       <p><a data-link-type="dfn" href="#animate-function" id="ref-for-animate-function-1">animate function</a> being <var>animate</var></p>
      <li data-md="">
       <p><a data-link-type="dfn" href="#element-proxy-map" id="ref-for-element-proxy-map-1">element proxy map</a> being <var>elements</var></p>
      <li data-md="">
       <p><a data-link-type="dfn" href="#animator-timeline-options-list" id="ref-for-animator-timeline-options-list-1">animator timeline options list</a> being <var>timelineOptions</var></p>
     </ul>
    <li data-md="">
     <p>Add the key-value pair (<var>name</var> - <var>definition</var>) to the <a data-link-type="dfn" href="#animator-name-to-animator-definition-map" id="ref-for-animator-name-to-animator-definition-map-2">animator name to animator
definition map</a> of the associated <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document">document</a>.</p>
   </ol>
   <p>When <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="parsing-an-animator-slot-list">parsing an animator slot list</dfn> for <code class="idl"><a data-link-type="idl" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor" id="ref-for-dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor-1">animatorCtor</a></code>, the user agent <em>must</em> run the following steps:</p>
   <ol>
    <li data-md="">
     <p>Let <var>elements</var> be an empty <code>sequence&lt;Dictionary></code>.</p>
    <li data-md="">
     <p>Let <var>elementsIterable</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p">Get</a>(<var>animatorCtor</var>, <var>elements</var>).</p>
    <li data-md="">
     <p>If <var>elementsIterable</var> is not <em>undefined</em>, then for each <var>slot</var> in <var>elementsIterable</var> run the
following steps:</p>
     <ul>
      <li data-md="">
       <p>Let <var>slotDictionary</var> be an empty dictionary.</p>
      <li data-md="">
       <p>Let the <var>name</var> key of <var>slotDictionary</var> be the <var>name</var> value of <var>element</var>.</p>
      <li data-md="">
       <p>Let the <var>inputProperties</var> key of <var>slotDictionary</var> be the result of <a data-link-type="dfn" href="#parsing-an-animator-property-list" id="ref-for-parsing-an-animator-property-list-1">parsing an animator property list</a> with name <em>inputProperties</em> for <var>slot</var>.</p>
      <li data-md="">
       <p>Let the <var>outputProperties</var> key of <var>slotDictionary</var> be the result of <a data-link-type="dfn" href="#parsing-an-animator-property-list" id="ref-for-parsing-an-animator-property-list-2">parsing an animator property list</a> with name <em>outputProperties</em> for <var>slot</var>.</p>
      <li data-md="">
       <p>Push <var>slotDictionary</var> onto <var>elements</var>.</p>
     </ul>
   </ol>
   <p>When <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="parsing-an-animator-property-list">parsing an animator property list</dfn> with name <em>name</em> for <em>slot</em>,
the user agent <em>must</em> run the following steps:</p>
   <ol>
    <li data-md="">
     <p>Let <var>properties</var> be an empty <code>sequence&lt;DOMString></code>.</p>
    <li data-md="">
     <p>Let <var>propertiesIterable</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p">Get</a>(<var>slot</var>, <var>name</var>).</p>
    <li data-md="">
     <p>If <var>propertiesIterable</var> is not <em>undefined</em>, then set <var>properties</var> to the result of
converting <var>propertiesIterable</var> to a <code>sequence&lt;DOMString></code>. If an
exception is thrown, rethrow the exception and abort all these steps.</p>
   </ol>
   <p>When <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="parsing-an-animator-timeline-options-list">parsing an animator timeline options list</dfn> for <code class="idl"><a data-link-type="idl" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor" id="ref-for-dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor-2">animatorCtor</a></code>,
the user agent <em>must</em> run the following steps:</p>
   <ol>
    <li data-md="">
     <p>Let <var>timelineOptions</var> be an empty <code>sequence&lt;Object></code>.</p>
    <li data-md="">
     <p>Let <var>timelinesIterable</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p">Get</a>(<var>animatorCtor</var>, <var>timelines</var>).</p>
    <li data-md="">
     <p>For each <var>timeline</var> in <var>timelinesIterable</var>, run the following steps:</p>
     <ol>
      <li data-md="">
       <p>If <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values">Type</a>(<var>timeline</var>) is <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></code> let <var>timelineObject</var> be <code>{ type: <var>timeline</var>, options: {} }</code>, otherwise let <var>timelineObject</var> be <var>timeline</var>.</p>
      <li data-md="">
       <p>Let <var>type</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p">Get</a>(<var>timelineObject</var>, "type").</p>
      <li data-md="">
       <p>Let <var>options</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-get-o-p">Get</a>(<var>timelineObject</var>, "options").</p>
      <li data-md="">
       <p>Process <var>type</var> and <var>options</var> according to the first matching condition in the following:</p>
       <div class="switch">
        <dl>
         <dt data-md="">If <var>type</var> or <var>options</var> is <b>undefined</b>,
         <dd data-md="">
          <p>throw a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#notsupportederror">NotSupportedError</a> and abort all remaining steps.</p>
         <dt data-md="">If <var>type</var> is "document",
         <dd data-md="">
          <p>Push a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/web-animations/#dictdef-documenttimelineoptions">DocumentTimelineOptions</a></code> created from <var>options</var> onto <var>timelineOptions</var>.</p>
         <dt data-md="">If <var>type</var> is "scroll",
         <dd data-md="">
          <p>Push a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#dictdef-scrolltimelineoptions">ScrollTimelineOptions</a></code> created from <var>options</var> onto <var>timelineOptions</var>.</p>
         <dt data-md="">Otherwise,
         <dd data-md="">
          <p>throw a <a data-link-type="dfn" href="https://heycam.github.io/webidl/#notsupportederror">NotSupportedError</a> and abort all remaining steps.</p>
        </dl>
       </div>
     </ol>
   </ol>
   <h2 class="heading settled" data-level="5" id="creating-animator"><span class="secno">5. </span><span class="content">Creating an Animator</span><a class="self-link" href="#creating-animator"></a></h2>
    Each <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-3">animator instance</a> lives in an <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope-3">AnimationWorkletGlobalScope</a></code>. The <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-4">animator instance</a> cannot be disposed arbitrarily (e.g., in the middle of running animation
as it may contain the scripted animation state. 
   <p>The <code class="idl"><a data-link-type="idl" href="#animationworkletglobalscope" id="ref-for-animationworkletglobalscope-4">AnimationWorkletGlobalScope</a></code> has an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="-animator-name-root-element-to-instance-map">(animator name, root element) to instance map</dfn>.
The map is populated when the user agent constructs a new <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-5">animator instance</a> in that scope.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="create-a-new-animator-instance">create a new animator instance</dfn> given a <var>name</var>, <var>root element</var>, and <var>workletGlobalScope</var>,
the user agent <em>must</em> run the following steps:</p>
   <ol>
    <li data-md="">
     <p>Let the <var>definition</var> be the result of looking up <var>name</var> on the <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#animator-name-to-animator-definition-map" id="ref-for-animator-name-to-animator-definition-map-3">animator name to animator definition map</a>.</p>
     <p>If <var>definition</var> does not exist abort the following steps.</p>
    <li data-md="">
     <p>Let <var>animatorInstanceMap</var> be <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#-animator-name-root-element-to-instance-map" id="ref-for--animator-name-root-element-to-instance-map-1">(animator name, root element) to
 instance map</a>.</p>
    <li data-md="">
     <p>If an entry exists for <var>name</var> and <var>root element</var> within <var>animatorInstanceMap</var> then abort the
 following steps.</p>
    <li data-md="">
     <p>Let <var>animatorCtor</var> be the <a data-link-type="dfn" href="#class-constructor" id="ref-for-class-constructor-2">class constructor</a> of <var>definition</var>.</p>
    <li data-md="">
     <p>Let <var>animatorInstance</var> be the result of <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-construct">Construct</a>(<var>animatorCtor</var>).</p>
     <p>If <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-construct">Construct</a> throws an exception, set the result of looking up <var>name</var> and <var>root element</var> in <var>animatorInstanceMap</var> to <b>null</b>, and abort the following steps.</p>
    <li data-md="">
     <p>Set the following on <var>animatorInstance</var> with:</p>
     <ul>
      <li data-md="">
       <p><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-2">animator name</a> being <var>name</var></p>
      <li data-md="">
       <p><a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag-2">animation requested flag</a> being <a data-link-type="dfn" href="#frame-current" id="ref-for-frame-current-1">frame-current</a></p>
     </ul>
    <li data-md="">
     <p>Set the result of looking up <var>name</var> and <var>root element</var> in <var>animatorInstanceMap</var> to <var>animatorInstance</var>.</p>
   </ol>
   <h2 class="heading settled" data-level="6" id="creating-element-proxy"><span class="secno">6. </span><span class="content">Creating an Element Proxy</span><a class="self-link" href="#creating-element-proxy"></a></h2>
    <a data-link-type="dfn" href="#element-proxy" id="ref-for-element-proxy-2">Element Proxy</a> objects are created by the user agent for elements which have either <a class="property" data-link-type="propdesc" href="#propdef-animator" id="ref-for-propdef-animator-1">animator</a> or <a class="property" data-link-type="propdesc" href="#propdef-animator-root" id="ref-for-propdef-animator-root-1">animator-root</a> CSS properties. They cannot be constructed from user script. A single element may
have multiple <a data-link-type="dfn" href="#element-proxy" id="ref-for-element-proxy-3">Element Proxy</a> objects associated with it; one per <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-6">animator instance</a>. 
   <p>The <code class="idl"><a data-link-type="idl" href="#elementproxy" id="ref-for-elementproxy-1">ElementProxy</a></code> interface exposes two maps: a read only map of proxied input properties to their
values, and a map of proxied output properties to their values. The input and output properties in
the maps are those specified in registerAnimator for the given <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-7">animator instance</a>.</p>
<pre class="idl highlight def">[
    <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<span class="n">AnimationWorklet</span>),
] <span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="elementproxy">ElementProxy</dfn> {
    <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly">StylePropertyMapReadOnly</a> <dfn class="nv idl-code" data-dfn-for="ElementProxy" data-dfn-type="attribute" data-export="" data-type="StylePropertyMapReadOnly" id="dom-elementproxy-inputstylemap">inputStyleMap<a class="self-link" href="#dom-elementproxy-inputstylemap"></a></dfn>;
    <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly">StylePropertyMapReadOnly</a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="ElementProxy" data-dfn-type="attribute" data-export="" data-type="StylePropertyMapReadOnly" id="dom-elementproxy-outputstylemap">outputStyleMap</dfn>;
};
</pre>
   <p class="issue" id="issue-65c145a8"><a class="self-link" href="#issue-65c145a8"></a> Todo: Should we have NoInterfaceObject/Exposed here? How do we properly represent that this
cannot be constructed via javascript?</p>
   <p>When user agent wants to <dfn data-dfn-type="dfn" data-noexport="" id="create-an-element-proxy">create an element proxy<a class="self-link" href="#create-an-element-proxy"></a></dfn> given <var>element</var> with a given <var>animatorSlot</var>, it <em>must</em> run the following steps:</p>
   <ol>
    <li data-md="">
     <p>Let <var>animatorInstance</var> be the <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-8">animator instance</a> associated with <var>element</var></p>
    <li data-md="">
     <p>Let <var>workletGlobalScope</var> be the scope associated with <var>animatorInstance</var>.</p>
    <li data-md="">
     <p>Let <var>definition</var> be the result of looking up <var>name</var> on the <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#animator-name-to-animator-definition-map" id="ref-for-animator-name-to-animator-definition-map-4">animator name to animator definition map</a>.</p>
    <li data-md="">
     <p>Let <var>slot</var> be the result of finding the item with name <var>animatorSlot</var> in the <a data-link-type="dfn" href="#animator-slot-list" id="ref-for-animator-slot-list-2">animator slot list</a> of <var>definition</var>.</p>
    <li data-md="">
     <p>Let <var>inputProperties</var> be <a data-link-type="dfn" href="#animator-input-property-list" id="ref-for-animator-input-property-list-1">animator input property list</a> of <var>slot</var>.</p>
    <li data-md="">
     <p>Let <var>outputProperties</var> be <a data-link-type="dfn" href="#animator-output-property-list" id="ref-for-animator-output-property-list-1">animator output property list</a> of <var>slot</var>.</p>
    <li data-md="">
     <p>Let <var>proxy</var> be a new <code class="idl"><a data-link-type="idl" href="#elementproxy" id="ref-for-elementproxy-2">ElementProxy</a></code> Object with:</p>
     <ul>
      <li data-md="">
       <p><a data-link-type="dfn" href="#proxied-element" id="ref-for-proxied-element-1">proxied element</a> being <var>element</var>.</p>
      <li data-md="">
       <p><code class="idl"><a data-link-type="idl" href="#dom-elementproxy-outputstylemap" id="ref-for-dom-elementproxy-outputstylemap-1">outputStyleMap</a></code> being a new <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymap">StylePropertyMap</a></code> for <var>outputProperties</var>.</p>
     </ul>
    <li data-md="">
     <p><a data-link-type="dfn" href="#update-proxy-input-style-map" id="ref-for-update-proxy-input-style-map-1">update proxy input style map</a> with <var>proxy</var> and <var>inputProperties</var>.</p>
    <li data-md="">
     <p>Associate <var>proxy</var> with <var>animatorInstance</var>.</p>
    <li data-md="">
     <p>Return proxy.</p>
   </ol>
   <p class="note" role="note"><span>Note:</span> Writing to the outputStyle map will update the effective value of the used style value of the <a data-link-type="dfn" href="#proxied-element" id="ref-for-proxied-element-2">proxied element</a>. This <em>may</em> happen asynchronously.</p>
   <p>When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="update-proxy-input-style-map">update proxy input style map</dfn> given <var>proxy</var>, and <var>properties</var>, it <em>must</em> run the following steps:</p>
   <ol>
    <li data-md="">
     <p>Let <var>styleMap</var> be a new <code class="idl"><a data-link-type="idl" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly">StylePropertyMapReadOnly</a></code> populated with <em>only</em> the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-4/#computed-value">computed value</a> of <a data-link-type="dfn" href="#proxied-element" id="ref-for-proxied-element-3">proxied element</a> for properties listed in <var>properties</var>.</p>
    <li data-md="">
     <p>Set <var>proxy</var>’s inputStyleMap to <var>styleMap</var>.</p>
   </ol>
   <p>When an element is removed, all proxies of that element are considered to be disconnected.
A disconnected proxy continues to have the last value from the <a data-link-type="dfn" href="https://drafts.csswg.org/css-cascade-4/#computed-value">computed value</a> of the <a data-link-type="dfn" href="#proxied-element" id="ref-for-proxied-element-4">proxied element</a> properties, but setting values on its outputStyleMap will have no
effect.</p>
   <h2 class="heading settled" data-level="7" id="requesting-animation-frames"><span class="secno">7. </span><span class="content">Requesting Animation Frames</span><a class="self-link" href="#requesting-animation-frames"></a></h2>
    Each <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-9">animator instance</a> has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="animation-requested-flag">animation requested flag</dfn>. It must be
either <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="frame-requested">frame-requested</dfn> or <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="frame-current">frame-current</dfn>. It is initially set to <a data-link-type="dfn" href="#frame-current" id="ref-for-frame-current-2">frame-current</a>. Various events can cause the <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag-3">animation requested flag</a> to be set to <a data-link-type="dfn" href="#frame-requested" id="ref-for-frame-requested-1">frame-requested</a>. 
   <p><a href="#running-animators">§8 Running Animators</a> resets the <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag-4">animation requested flag</a> on animators to <a data-link-type="dfn" href="#frame-current" id="ref-for-frame-current-3">frame-current</a>.</p>
   <h3 class="heading settled" data-level="7.1" id="requesting-animation-frames-element-proxy"><span class="secno">7.1. </span><span class="content">Element proxy creation/removal</span><a class="self-link" href="#requesting-animation-frames-element-proxy"></a></h3>
   <p>When a new element proxy is assigned to or removed from an <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-10">animator instance</a>, that <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-11">animator instance</a>’s <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag-5">animation requested flag</a> should be set to <a data-link-type="dfn" href="#frame-requested" id="ref-for-frame-requested-2">frame-requested</a>.</p>
   <h3 class="heading settled" data-level="7.2" id="requesting-animation-frames-computed-style"><span class="secno">7.2. </span><span class="content">Change in an element’s computed style</span><a class="self-link" href="#requesting-animation-frames-computed-style"></a></h3>
   <p>When the computed style for an element changes, the user agent <em>must</em> run the following steps:</p>
   <p>For each <a data-link-type="dfn" href="#element-proxy" id="ref-for-element-proxy-4">element proxy</a> for that element, perform the following steps:</p>
   <ol>
    <li data-md="">
     <p>Let <var>proxy</var> be the current <a data-link-type="dfn" href="#element-proxy" id="ref-for-element-proxy-5">element proxy</a> of the element.</p>
    <li data-md="">
     <p>Let <var>animator</var> be the <var>proxy</var>’s assigned animator.</p>
    <li data-md="">
     <p>Let <var>name</var> be the <var>animator</var>’s name.</p>
    <li data-md="">
     <p>Let <var>definition</var> be the result of looking up <var>name</var> on the <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#animator-name-to-animator-definition-map" id="ref-for-animator-name-to-animator-definition-map-5">animator name to animator definition map</a>.</p>
    <li data-md="">
     <p>Let <var>slot</var> be the result of finding the item with name <var>animatorSlot</var> in the <a data-link-type="dfn" href="#animator-slot-list" id="ref-for-animator-slot-list-3">animator slot list</a> of <var>definition</var>.</p>
    <li data-md="">
     <p>Let <var>inputProperties</var> be <a data-link-type="dfn" href="#animator-input-property-list" id="ref-for-animator-input-property-list-2">animator input property list</a> of <var>slot</var>.</p>
    <li data-md="">
     <p>For each property in <var>inputProperties</var>, if the property’s computed value has changed,
set the <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag-6">animation requested flag</a> on the <var>animator</var> to <a data-link-type="dfn" href="#frame-requested" id="ref-for-frame-requested-3">frame-requested</a>.</p>
   </ol>
   <h3 class="heading settled" data-level="7.3" id="requesting-animation-frames-document-timeline"><span class="secno">7.3. </span><span class="content">Animator specifies a DocumentTimeline</span><a class="self-link" href="#requesting-animation-frames-document-timeline"></a></h3>
   <p>If a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/web-animations/#dictdef-documenttimelineoptions">DocumentTimelineOptions</a></code> instance is present in an animator’s <a data-link-type="dfn" href="#animator-timeline-options-list" id="ref-for-animator-timeline-options-list-2">animator timeline options
list</a> then that animator’s <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag-7">animation requested flag</a> <em>must</em> be set to <a data-link-type="dfn" href="#frame-requested" id="ref-for-frame-requested-4">frame-requested</a> at the start of each animation frame.</p>
   <h3 class="heading settled" data-level="7.4" id="requesting-animation-frames-scroll-timeline"><span class="secno">7.4. </span><span class="content">Animator specifies a ScrollTimeline</span><a class="self-link" href="#requesting-animation-frames-scroll-timeline"></a></h3>
   <p>If a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#dictdef-scrolltimelineoptions">ScrollTimelineOptions</a></code> <var>instance</var> is present in an animator’s <a data-link-type="dfn" href="#animator-timeline-options-list" id="ref-for-animator-timeline-options-list-3">animator timeline options
list</a> then the user agent <em>must</em> run the following steps when the scroll position of the
nearest non-visible overflow ancestor to the animator’s <a data-link-type="dfn" href="#root-element" id="ref-for-root-element-1">root element</a> changes:</p>
   <ol>
    <li data-md="">
     <p>For each <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#dictdef-scrolltimelineoptions">ScrollTimelineOptions</a></code> instance <var>options</var> in the animator’s <a data-link-type="dfn" href="#animator-timeline-options-list" id="ref-for-animator-timeline-options-list-4">animator timeline
   options list</a> do the following steps:</p>
     <ol>
      <li data-md="">
       <p>Let <var>timeline</var> be a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#scrolltimeline">ScrollTimeline</a></code> created from <var>options</var>, adding the nearest non-visible
 overflow ancestor of the <a data-link-type="dfn" href="#root-element" id="ref-for-root-element-2">root element</a> as the <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#dom-scrolltimeline-scrollsource">scrollSource</a></code>.</p>
      <li data-md="">
       <p>If the <a data-link-type="dfn" href="https://wicg.github.io/scroll-animations/#current-time-algorithm">current time of the ScrollTimeline</a> <var>timeline</var> would have changed due to the
 change in scroll position, set the animator’s <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag-8">animation requested flag</a> to <a data-link-type="dfn" href="#frame-requested" id="ref-for-frame-requested-5">frame-requested</a>.</p>
     </ol>
   </ol>
   <p class="issue" id="issue-9b16e52a"><a class="self-link" href="#issue-9b16e52a"></a> Give each animator instance a re-used set of AnimationTimelines instead of creating them
       specifically here and when running animations.</p>
   <p class="issue" id="issue-a9c8649c"><a class="self-link" href="#issue-a9c8649c"></a> Need to add a definition for 'nearest non-visible overflow ancestor' to make sure all mentions
       stay in sync.</p>
   <h2 class="heading settled" data-level="8" id="running-animators"><span class="secno">8. </span><span class="content">Running Animators</span><a class="self-link" href="#running-animators"></a></h2>
   <p>When a user agent wants to produce a new animation frame, if for any <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-12">animator instance</a> the
associated <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag-9">animation requested flag</a> is <a data-link-type="dfn" href="#frame-requested" id="ref-for-frame-requested-6">frame-requested</a> then the the user agent <em>must</em> <a data-link-type="dfn" href="#run-animators" id="ref-for-run-animators-1">run animators</a> for the current frame.</p>
   <p class="note" role="note"><span>Note:</span> The user agent is not required to run animations on every frame. It is legal to defer
      generating an animation frame until a later frame. This allow the user agent to
      provide a different service level according to their policy.</p>
   <p>When the user agent wants to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="run-animators">run animators</dfn> in a given <var>workletGlobalScope</var>, it <em>must</em> iterate over all pairs of animator name and root element as (<var>animatorName</var>, <var>rootElement</var>). For each such pair:</p>
   <ol>
    <li data-md="">
     <p>Let the <var>definition</var> be the result of looking up <var>animatorName</var> on the <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#animator-name-to-animator-definition-map" id="ref-for-animator-name-to-animator-definition-map-6">animator name to animator definition map</a>.</p>
     <p>If <var>definition</var> does not exist then abort the following steps.</p>
    <li data-md="">
     <p>Let <var>instance</var> be the result of looking up (<var>animatorName</var>, <var>rootElement</var>) in the <var>workletGlobalScope</var>’s <a data-link-type="dfn" href="#-animator-name-root-element-to-instance-map" id="ref-for--animator-name-root-element-to-instance-map-2">(animator name, root element) to instance map</a>.</p>
     <p>If <var>instance</var> does not exist then <a data-link-type="dfn" href="#create-a-new-animator-instance" id="ref-for-create-a-new-animator-instance-1">create a new animator instance</a> for <var>animatorName</var>, <var>rootElement</var>, and <var>workletGlobalScope</var>, and let <var>instance</var> be the result of that.</p>
    <li data-md="">
     <p>If <var>instance</var> still does not exist or <var>instance</var> is <b>null</b> then abort the following steps.</p>
    <li data-md="">
     <p>If the <a data-link-type="dfn" href="#animation-requested-flag" id="ref-for-animation-requested-flag-10">animation requested flag</a> for <var>instance</var> is <a data-link-type="dfn" href="#frame-current" id="ref-for-frame-current-4">frame-current</a> or the proxies
    belonging to <var>instance</var> will not be visible within the visual viewport of the current frame
    the user agent <em>may</em> abort all the following steps.</p>
     <p class="issue" id="issue-dc52329c"><a class="self-link" href="#issue-dc52329c"></a> Consider giving user agents permission to skip running animator instances to throttle
    slow animators.</p>
    <li data-md="">
     <p>Let <var>animateFunction</var> be <var>definition</var>’s <a data-link-type="dfn" href="#animate-function" id="ref-for-animate-function-2">animate function</a>.</p>
    <li data-md="">
     <p>Let <var>timelines</var> be an empty <code>sequence&lt;AnimationTimeline></code>.</p>
    <li data-md="">
     <p>For each <var>timelineOptions</var> in the <a data-link-type="dfn" href="#animator-timeline-options-list" id="ref-for-animator-timeline-options-list-5">animator timeline options list</a> of <var>definition</var>, do the
   following:</p>
     <ul>
      <li data-md="">
       <p>If <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values">Type</a>(<var>timelineOptions</var>) is <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/web-animations/#dictdef-documenttimelineoptions">DocumentTimelineOptions</a></code>, push a new <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/web-animations/#documenttimeline">DocumentTimeline</a></code> created using <var>timelineOptions</var> to the <var>timelines</var> list.</p>
      <li data-md="">
       <p>If <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values">Type</a>(<var>timelineOptions</var>) is <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#dictdef-scrolltimelineoptions">ScrollTimelineOptions</a></code>, push a new <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#scrolltimeline">ScrollTimeline</a></code> created using <var>timelineOptions</var> to the <var>timelines</var> list, adding the nearest non-visible
overflow ancestor of <var>rootElement</var> as the <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/scroll-animations/#dom-scrolltimeline-scrollsource">scrollSource</a></code>.</p>
     </ul>
    <li data-md="">
     <p>Let <var>elementMap</var> be an <a data-link-type="dfn" href="#element-proxy-map" id="ref-for-element-proxy-map-2">element proxy map</a> of <var>instance</var>.</p>
    <li data-md="">
     <p><a data-link-type="dfn" href="https://heycam.github.io/webidl/#es-invoking-callback-functions">Invoke</a> <var>animateFunction</var> with arguments «<var>elementMap</var>, <var>timelines</var>»,
    and with <var>instance</var> as the <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-callback-this-value">callback this value</a>.</p>
   </ol>
   <p class="note" role="note"><span>Note:</span> Although inefficient, it is legal for the user agent to <a data-link-type="dfn" href="#run-animators" id="ref-for-run-animators-2">run animators</a> multiple times
in the same frame.</p>
   <h2 class="heading settled" data-level="9" id="closing-animator"><span class="secno">9. </span><span class="content">Closing an Animator</span><a class="self-link" href="#closing-animator"></a></h2>
   <p class="issue" id="issue-d4d8f39c"><a class="self-link" href="#issue-d4d8f39c"></a> Todo: Define when we may get rid of the animator.</p>
   <h2 class="heading settled" data-level="10" id="css-animator-notation"><span class="secno">10. </span><span class="content">CSS Animator Notation</span><a class="self-link" href="#css-animator-notation"></a></h2>
   <p>Two CSS properties <a class="property" data-link-type="propdesc" href="#propdef-animator-root" id="ref-for-propdef-animator-root-2">animator-root</a> and <a class="property" data-link-type="propdesc" href="#propdef-animator" id="ref-for-propdef-animator-2">animator</a> may be used to assign an HTML elements to an <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-13">animator instance</a> either as a root element or a child element.</p>
   <table class="def propdef" data-link-for-hint="animator-root">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export="" id="propdef-animator-root">animator-root</dfn>
     <tr class="value">
      <th>Value:
      <td class="prod">none <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one">|</a> [<a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-3">animator name</a> <a data-link-type="dfn" href="#animator-slot" id="ref-for-animator-slot-2">animator slot</a><a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-comma">,</a> ]<a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#mult-zero-plus">*</a> <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-4">animator name</a> <a data-link-type="dfn" href="#animator-slot" id="ref-for-animator-slot-3">animator slot</a>
     <tr>
      <th>Initial:
      <td>none
     <tr>
      <th>Applies to:
      <td><a href="https://drafts.csswg.org/css-pseudo/#generated-content" title="Includes ::before and ::after pseudo-elements.">all elements</a>
     <tr>
      <th>Inherited:
      <td>no
     <tr>
      <th>Percentages:
      <td>N/A
     <tr>
      <th>Media:
      <td>interactive
     <tr>
      <th>Computed value:
      <td>as specified
     <tr>
      <th>Canonical order:
      <td>per grammar
     <tr>
      <th>Animatable:
      <td>no
   </table>
   <dl>
    <dt><dfn class="css" data-dfn-for="animator-root" data-dfn-type="value" data-export="" id="valdef-animator-root-none">none<a class="self-link" href="#valdef-animator-root-none"></a></dfn> 
    <dd> There will be no <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-14">animator instance</a> that has this element as its <a data-link-type="dfn" href="#root-element" id="ref-for-root-element-3">root element</a>. 
    <dt><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-5">animator name</a> <a data-link-type="dfn" href="#animator-slot" id="ref-for-animator-slot-4">animator slot</a> 
    <dd>
      For each <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-6">animator name</a> specified in the list, the following applies for each animation frame: 
     <ul>
      <li data-md="">
       <p>If there is no <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definition-3">animator definition</a> registered with the given <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-7">animator name</a>, the inclusion
of that <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-8">animator name</a> as a value has no effect.</p>
      <li data-md="">
       <p>Otherwise, an <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-15">animator instance</a> with this element as its <a data-link-type="dfn" href="#root-element" id="ref-for-root-element-4">root element</a> will exist and will have its <a data-link-type="dfn" href="#animate-function" id="ref-for-animate-function-3">animate function</a> called (with respect to the rules
laid out in <a href="#running-animators">§8 Running Animators</a>) with an <a data-link-type="dfn" href="#element-proxy" id="ref-for-element-proxy-6">element proxy</a> for this element passed as
one of the <a data-link-type="dfn" href="#element-proxy" id="ref-for-element-proxy-7">element proxies</a> for the given <a data-link-type="dfn" href="#animator-slot" id="ref-for-animator-slot-5">animator slot</a>.</p>
     </ul>
     <p>If the same <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-9">animator name</a> occurs multiple times in the list, only the first occurrence of that <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-10">animator name</a> is processed.</p>
   </dl>
   <table class="def propdef" data-link-for-hint="animator">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export="" id="propdef-animator">animator</dfn>
     <tr class="value">
      <th>Value:
      <td class="prod">none <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one">|</a> [<a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-11">animator name</a> <a data-link-type="dfn" href="#animator-slot" id="ref-for-animator-slot-6">animator slot</a><a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-comma">,</a> ]<a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#mult-zero-plus">*</a> <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-12">animator name</a> <a data-link-type="dfn" href="#animator-slot" id="ref-for-animator-slot-7">animator slot</a>
     <tr>
      <th>Initial:
      <td>none
     <tr>
      <th>Applies to:
      <td><a href="https://drafts.csswg.org/css-pseudo/#generated-content" title="Includes ::before and ::after pseudo-elements.">all elements</a>
     <tr>
      <th>Inherited:
      <td>no
     <tr>
      <th>Percentages:
      <td>N/A
     <tr>
      <th>Media:
      <td>interactive
     <tr>
      <th>Computed value:
      <td>as specified
     <tr>
      <th>Canonical order:
      <td>per grammar
     <tr>
      <th>Animatable:
      <td>no
   </table>
   <dl>
    <dt><dfn class="css" data-dfn-for="animator" data-dfn-type="value" data-export="" id="valdef-animator-none">none<a class="self-link" href="#valdef-animator-none"></a></dfn> 
    <dd> This element will not be passed into any <a data-link-type="dfn" href="#animate-function" id="ref-for-animate-function-4">animate function</a> as one of the <a data-link-type="dfn" href="#element-proxy" id="ref-for-element-proxy-8">element proxies</a>. 
    <dt><a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-13">animator name</a> <a data-link-type="dfn" href="#animator-slot" id="ref-for-animator-slot-8">animator slot</a> 
    <dd>
      For each <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-14">animator name</a> specified in the list, the following applies for each animation frame: 
     <ul>
      <li data-md="">
       <p>If there is no <a data-link-type="dfn" href="#animator-definition" id="ref-for-animator-definition-4">animator definition</a> registered with the given <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-15">animator name</a>, the inclusion
of that <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-16">animator name</a> as a value has no effect.</p>
      <li data-md="">
       <p>Otherwise, an <a data-link-type="dfn" href="#element-proxy" id="ref-for-element-proxy-9">element proxy</a> for this element will be passed into the <a data-link-type="dfn" href="#animate-function" id="ref-for-animate-function-5">animate function</a> of the closest ancestor <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-16">animator instance</a> with the given <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-17">animator name</a> as one of the <a data-link-type="dfn" href="#element-proxy" id="ref-for-element-proxy-10">element proxies</a> for the given <a data-link-type="dfn" href="#animator-slot" id="ref-for-animator-slot-9">animator slot</a>. If no
such <a data-link-type="dfn" href="#animator-instance" id="ref-for-animator-instance-17">animator instance</a> exists, one is created with the document root element as its <a data-link-type="dfn" href="#root-element" id="ref-for-root-element-5">root element</a>.</p>
     </ul>
     <p>If the same <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-18">animator name</a> occurs multiple times in the list, only the first occurrence of that <a data-link-type="dfn" href="#animator-name" id="ref-for-animator-name-19">animator name</a> is processed.</p>
   </dl>
   <h2 class="heading settled" data-level="11" id="effect-stack"><span class="secno">11. </span><span class="content">Effect Stack</span><a class="self-link" href="#effect-stack"></a></h2>
   <p class="issue" id="issue-b3b90f2d"><a class="self-link" href="#issue-b3b90f2d"></a> Todo: the animators output style values have the highest order in animation stack effect and
their composite operation is "replace" which is going to allow them to run independent on other
animations and in a different thread. Supporting other composite operation is not in scope at this
point.</p>
   <h2 class="heading settled" data-level="12" id="security-considerations"><span class="secno">12. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
   <p class="issue" id="issue-de770110"><a class="self-link" href="#issue-de770110"></a> Need to decide what security considerations there are for this spec.</p>
   <h2 class="heading settled" data-level="13" id="privacy-considerations"><span class="secno">13. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy-considerations"></a></h2>
   <p class="issue" id="issue-19f9ed9b"><a class="self-link" href="#issue-19f9ed9b"></a> Need to decide what privacy considerations there are for this spec.</p>
   <h2 class="heading settled" data-level="14" id="examples"><span class="secno">14. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h2>
   <h3 class="heading settled" data-level="14.1" id="example-1"><span class="secno">14.1. </span><span class="content">Example 1: A fade-in animation with spring timing.</span><a class="self-link" href="#example-1"></a></h3>
<pre class="lang-markup highlight"><span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
<span class="p">.</span><span class="nc">myFadein</span> <span class="p">{</span>
  <span class="n">animator</span><span class="p">:</span> <span class="s1">'spring'</span> <span class="s1">'fadein'</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">style</span><span class="p">></span>


<span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">'myFadein'</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">section</span><span class="p">></span>
<span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">'myFadein'</span> <span class="na">style</span><span class="o">=</span><span class="s">"--spring-k: 25;"</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">section</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
document<span class="p">.</span>animationWorklet<span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="s1">'spring-timing.js'</span><span class="p">)</span><span class="p">;</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
</pre>
<pre class="lang-javascript highlight"><span class="c1">// Inside AnimationWorkletGlobalScope
</span>registerAnimator<span class="p">(</span><span class="s1">'spring'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>

    <span class="kr">static</span> elements <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>name<span class="o">:</span> <span class="s1">'fadein'</span><span class="p">,</span> inputProperties<span class="o">:</span>  <span class="p">[</span><span class="s1">'--spring-k'</span><span class="p">]</span><span class="p">,</span> outputProperties <span class="o">=</span>  <span class="p">[</span><span class="s1">'opacity'</span><span class="p">]</span><span class="p">}</span><span class="p">]</span><span class="p">;</span>
    <span class="kr">static</span> timelines <span class="o">=</span> <span class="p">[</span><span class="s1">'document'</span><span class="p">]</span><span class="p">;</span>

    animate<span class="p">(</span>elementMap<span class="p">,</span> timelines<span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span>startTime_ <span class="o">=</span> <span class="k">this</span><span class="p">.</span>startTime_ <span class="o">||</span> timelines<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>currentTime<span class="p">;</span>
        <span class="kr">const</span> deltaT <span class="o">=</span> timelines<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>currentTime <span class="o">-</span> <span class="k">this</span><span class="p">.</span>startTime_<span class="p">;</span>
        elementMap<span class="p">.</span>get<span class="p">(</span><span class="s1">'fadein'</span><span class="p">)</span><span class="p">.</span>forEach<span class="p">(</span>elem <span class="p">=></span> <span class="p">{</span>
          <span class="c1">// read a custom css property.
</span>          <span class="kr">const</span> k <span class="o">=</span> elem<span class="p">.</span>inputStyleMap<span class="p">.</span>get<span class="p">(</span><span class="s1">'--spring-k'</span><span class="p">)</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
          <span class="c1">// compute progress using a fancy spring timing function.
</span>          <span class="kr">const</span> effectiveValue <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> springTiming<span class="p">(</span>deltaT<span class="p">,</span> k<span class="p">)</span><span class="p">;</span>
          <span class="c1">// update opacity accordingly.
</span>          elem<span class="p">.</span>ouputStyleMap<span class="p">.</span>opacity <span class="o">=</span> effectiveValue<span class="p">;</span>
        <span class="p">}</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>

    springTiming<span class="p">(</span>deltaT<span class="p">,</span> k<span class="p">)</span> <span class="p">{</span>
        <span class="c1">// simulate the spring effect and return a progress value between [-1, 1];
</span>    <span class="p">}</span>
<span class="p">}</span><span class="p">)</span><span class="p">;</span>
</pre>
   <h3 class="heading settled" data-level="14.2" id="example-2"><span class="secno">14.2. </span><span class="content">Example 2: Twitter header.</span><a class="self-link" href="#example-2"></a></h3>
<pre class="lang-markup highlight"><span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
<span class="p">#</span><span class="nn">scroller</span> <span class="p">{</span>
  <span class="n">animator-root</span><span class="p">:</span> <span class="n">twitter-header</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">avatar</span> <span class="p">{</span>
  <span class="n">animator</span><span class="p">:</span> <span class="n">twitter-header</span> <span class="n">avatar</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">bar</span> <span class="p">{</span>
  <span class="n">animator</span><span class="p">:</span> <span class="n">twitter-header</span> <span class="n">bar</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">style</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"scroller"</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">"bar"</span><span class="p">></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">section</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">header</span><span class="p">></span>
    <span class="p">&lt;</span><span class="nt">picture</span> <span class="na">class</span><span class="o">=</span><span class="s">"avatar"</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"avatar.jpg"</span><span class="p">></span>
    <span class="p">&lt;</span><span class="p">/</span><span class="nt">picture</span><span class="p">></span>
    <span class="p">&lt;</span><span class="nt">section</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nt">button</span><span class="p">></span>Friends<span class="p">&lt;</span><span class="p">/</span><span class="nt">button</span><span class="p">></span>
      <span class="p">&lt;</span><span class="nt">button</span><span class="p">></span>Edit Profile<span class="p">&lt;</span><span class="p">/</span><span class="nt">button</span><span class="p">></span>
    <span class="p">&lt;</span><span class="p">/</span><span class="nt">section</span><span class="p">></span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">header</span><span class="p">></span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
document<span class="p">.</span>animationWorklet<span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="s1">'tweeter-header.js'</span><span class="p">)</span><span class="p">;</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
</pre>
<pre class="lang-javascript highlight"><span class="c1">// Inside AnimationWorkletGlobalScope.
</span>registerAnimator<span class="p">(</span><span class="s1">'twitter-header'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>

  <span class="kr">static</span> elements <span class="o">=</span>  <span class="p">[</span>
    <span class="p">{</span>name<span class="o">:</span> <span class="s1">'avatar'</span><span class="p">,</span> inputProperties<span class="o">:</span> <span class="p">[</span><span class="p">]</span><span class="p">,</span> outputProperties<span class="o">:</span> <span class="p">[</span><span class="s1">'transform'</span><span class="p">]</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span>name<span class="o">:</span> <span class="s1">'bar'</span><span class="p">,</span> inputProperties<span class="o">:</span> <span class="p">[</span><span class="p">]</span><span class="p">,</span> outputProperties<span class="o">:</span> <span class="p">[</span><span class="s1">'opacity'</span><span class="p">]</span><span class="p">}</span>
  <span class="p">]</span><span class="p">;</span>

  <span class="c1">// maps scroll offset [0, 140px] -> time values [0, 1]
</span>  <span class="kr">static</span> timelines <span class="o">=</span> <span class="p">[</span> <span class="p">{</span> type<span class="o">:</span> <span class="s1">'scroll'</span><span class="p">,</span> options<span class="o">:</span> <span class="p">{</span>
      orientation<span class="o">:</span> <span class="s1">'vertical'</span><span class="p">,</span>
      endScrollOffset<span class="o">:</span> <span class="s1">'140px'</span><span class="p">,</span>
      timeRange<span class="o">:</span> <span class="mi">1</span>
    <span class="p">}</span><span class="p">}</span><span class="p">,</span>
  <span class="p">]</span><span class="p">;</span>


  animate<span class="p">(</span>elementMap<span class="p">,</span> timelines<span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> progress <span class="o">=</span> timelines<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>currentTime<span class="p">;</span>

    elementMap<span class="p">.</span>get<span class="p">(</span><span class="s1">'avatar'</span><span class="p">)</span><span class="p">.</span>forEach<span class="p">(</span>elem <span class="p">=></span> <span class="p">{</span>
      elem<span class="p">.</span>outputStyleMap<span class="p">.</span>set<span class="p">(</span><span class="s1">'transform'</span><span class="p">,</span> <span class="k">new</span> CSSTransformValue<span class="p">(</span><span class="p">[</span>
          <span class="k">new</span> CSSTranslation<span class="p">(</span><span class="k">new</span> CSSSimpleLength<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'px'</span><span class="p">)</span><span class="p">,</span>
                             <span class="k">new</span> CSSSimpleLength<span class="p">(</span>tween<span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span><span class="p">(</span>progress<span class="p">)</span><span class="p">,</span> <span class="s1">'px'</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
          <span class="k">new</span> CSSScale<span class="p">(</span>tween<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span><span class="p">(</span>progress<span class="p">)</span><span class="p">,</span> tween<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span><span class="p">(</span>progress<span class="p">)</span><span class="p">)</span>
          <span class="p">]</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span><span class="p">)</span><span class="p">;</span>
    elementMap<span class="p">.</span>get<span class="p">(</span><span class="s1">'bar'</span><span class="p">)</span><span class="p">.</span>forEach<span class="p">(</span>elem <span class="p">=></span> <span class="p">{</span>
      elem<span class="p">.</span>outputStyleMap<span class="p">.</span>set<span class="p">(</span><span class="s1">'opacity'</span><span class="p">,</span> progress<span class="p">)</span><span class="p">;</span>
    <span class="p">}</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

  tween<span class="p">(</span>begin<span class="p">,</span> end<span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> lerp<span class="p">(</span>progress<span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> begin <span class="o">+</span> <span class="p">(</span>end <span class="o">-</span> begin<span class="p">)</span> <span class="o">*</span> progress<span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">)</span><span class="p">;</span>
</pre>
   <h3 class="heading settled" data-level="14.3" id="example-3"><span class="secno">14.3. </span><span class="content">Example 3: Parallax backgrounds.</span><a class="self-link" href="#example-3"></a></h3>
<pre class="lang-markup highlight"><span class="p">&lt;</span><span class="nt">style</span><span class="p">></span>
<span class="p">#</span><span class="nn">scroller</span> <span class="p">{</span>
  <span class="n">animator-root</span><span class="p">:</span> <span class="s1">'parallax'</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">background</span> <span class="p">{</span>
  <span class="n">animator</span><span class="p">:</span> <span class="s1">'parallax'</span> <span class="s1">'background'</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">&lt;</span><span class="p">/</span><span class="nt">style</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"scroller"</span><span class="p">></span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"background"</span> <span class="na">style</span><span class="o">=</span><span class="s">"--parallax-rate: 0.6"</span> <span class="p">></span>
    <span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">></span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"background"</span> <span class="na">style</span><span class="o">=</span><span class="s">"--parallax-rate: 0.3"</span> <span class="p">></span>
    <span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">></span>

    overflowing content!
<span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">></span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">></span>
document<span class="p">.</span>animationWorklet<span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="s1">'parallax.js'</span><span class="p">)</span><span class="p">;</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">></span>
</pre>
<pre class="lang-javascript highlight"><span class="c1">// Inside AnimationWorkletGlobalScope
</span>registerAnimation<span class="p">(</span><span class="s1">'parallax'</span><span class="p">,</span> <span class="kr">class</span> <span class="p">{</span>

    <span class="kr">static</span> elements <span class="o">=</span>  <span class="p">[</span>
        <span class="p">{</span> name<span class="o">:</span> <span class="s1">'background'</span><span class="p">,</span> inputProperties<span class="o">:</span> <span class="p">[</span><span class="s1">'--parallax-rate'</span><span class="p">]</span><span class="p">,</span> outputProperties<span class="o">:</span> <span class="p">[</span><span class="s1">'transform'</span><span class="p">]</span><span class="p">}</span>
    <span class="p">]</span><span class="p">;</span>

    <span class="kr">static</span> timelines <span class="o">=</span> <span class="p">[</span><span class="p">{</span> type<span class="o">:</span> <span class="s1">'scroll'</span><span class="p">,</span> options<span class="o">:</span> <span class="p">{</span> orientation<span class="o">:</span> <span class="s1">'vertical'</span><span class="p">}</span> <span class="p">}</span><span class="p">]</span><span class="p">;</span>

    <span class="c1">// This can be passed in as an input but we should consider exposing this in ScrollTimeline
</span>    <span class="kr">static</span> SCROLL_SIZE <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>

    animate<span class="p">(</span>elementMap<span class="p">,</span> timelines<span class="p">)</span> <span class="p">{</span>
        <span class="c1">// read root scroller vertical scroll offset.
</span>        <span class="kr">const</span> scrollTop <span class="o">=</span> timelines<span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">.</span>currentTime <span class="o">*</span> SCROLL_SIZE<span class="p">;</span>
        <span class="c1">// update parallax transform
</span>        elementMap<span class="p">.</span>get<span class="p">(</span><span class="s1">'background'</span><span class="p">)</span><span class="p">.</span>forEach<span class="p">(</span>elem <span class="p">=></span> <span class="p">{</span>
           <span class="kr">const</span> rate <span class="o">=</span> elem<span class="p">.</span>inputStyleMap<span class="p">.</span>get<span class="p">(</span><span class="s1">'--parallax-rate'</span><span class="p">)</span> <span class="o">||</span> <span class="mf">0.2</span><span class="p">;</span>
           elem<span class="p">.</span>outputStyleMap<span class="p">.</span>set<span class="p">(</span><span class="s1">'transform'</span><span class="p">,</span> <span class="k">new</span> CSSTransformValue<span class="p">(</span><span class="p">[</span>
            <span class="k">new</span> CSSTranslation<span class="p">(</span><span class="k">new</span> CSSSimpleLength<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'px'</span><span class="p">)</span><span class="p">,</span> <span class="k">new</span> CSSSimpleLength<span class="p">(</span>rate <span class="o">*</span> scrollTop<span class="p">,</span> <span class="s1">'px'</span><span class="p">)</span><span class="p">)</span><span class="p">]</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
        <span class="p">}</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span><span class="p">)</span><span class="p">;</span>
</pre>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content"> Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p> Conformance requirements are expressed with a combination of descriptive assertions and RFC 2119 terminology.
            The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
            in the normative parts of this document
            are to be interpreted as described in RFC 2119.
            However, for readability,
            these words do not appear in all uppercase letters in this specification. </p>
   <p> All of the text of this specification is normative
            except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p> Examples in this specification are introduced with the words “for example”
            or are set apart from the normative text with <code>class="example"</code>, like this: </p>
   <div class="example" id="example-example"><a class="self-link" href="#example-example"></a> This is an example of an informative example. </div>
   <p> Informative notes begin with the word “Note”
            and are set apart from the normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note"> Note, this is an informative note. </p>
  </div>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#animate-function">animate function</a><span>, in §3</span>
   <li><a href="#animation-requested-flag">animation requested flag</a><span>, in §7</span>
   <li><a href="#animation-worklet">Animation Worklet</a><span>, in §2</span>
   <li><a href="#dom-window-animationworklet">animationWorklet</a><span>, in §2</span>
   <li><a href="#animationworklet">AnimationWorklet</a><span>, in §2</span>
   <li><a href="#animationworkletglobalscope">AnimationWorkletGlobalScope</a><span>, in §2</span>
   <li><a href="#propdef-animator">animator</a><span>, in §10</span>
   <li><a href="#animator-definition">animator definition</a><span>, in §3</span>
   <li><a href="#animator-input-property-list">animator input property list</a><span>, in §3</span>
   <li><a href="#animator-instance">animator instance</a><span>, in §3</span>
   <li><a href="#animator-name">animator name</a><span>, in §3</span>
   <li><a href="#-animator-name-root-element-to-instance-map">(animator name, root element) to instance map</a><span>, in §5</span>
   <li><a href="#animator-name-to-animator-definition-map">animator name to animator definition map</a><span>, in §4</span>
   <li><a href="#animator-output-property-list">animator output property list</a><span>, in §3</span>
   <li><a href="#propdef-animator-root">animator-root</a><span>, in §10</span>
   <li><a href="#animator-slot">animator slot</a><span>, in §3</span>
   <li><a href="#animator-slot-list">animator slot list</a><span>, in §3</span>
   <li><a href="#animator-timeline-options-list">animator timeline options list</a><span>, in §3</span>
   <li><a href="#class-constructor">class constructor</a><span>, in §3</span>
   <li><a href="#create-an-element-proxy">create an element proxy</a><span>, in §6</span>
   <li><a href="#create-a-new-animator-instance">create a new animator instance</a><span>, in §5</span>
   <li><a href="#elementproxy">ElementProxy</a><span>, in §6</span>
   <li><a href="#element-proxy">element proxy</a><span>, in §3</span>
   <li><a href="#element-proxy-map">element proxy map</a><span>, in §3</span>
   <li><a href="#frame-current">frame-current</a><span>, in §7</span>
   <li><a href="#frame-requested">frame-requested</a><span>, in §7</span>
   <li><a href="#dom-animationworklet-import">import(moduleURL)</a><span>, in §2</span>
   <li><a href="#input-property-list">input property list</a><span>, in §3</span>
   <li><a href="#dom-elementproxy-inputstylemap">inputStyleMap</a><span>, in §6</span>
   <li>
    none
    <ul>
     <li><a href="#valdef-animator-root-none">value for animator-root</a><span>, in §10</span>
     <li><a href="#valdef-animator-none">value for animator</a><span>, in §10</span>
    </ul>
   <li><a href="#output-property-list">output property list</a><span>, in §3</span>
   <li><a href="#dom-elementproxy-outputstylemap">outputStyleMap</a><span>, in §6</span>
   <li><a href="#parsing-an-animator-property-list">parsing an animator property list</a><span>, in §4</span>
   <li><a href="#parsing-an-animator-slot-list">parsing an animator slot list</a><span>, in §4</span>
   <li><a href="#parsing-an-animator-timeline-options-list">parsing an animator timeline options list</a><span>, in §4</span>
   <li><a href="#proxied-element">proxied element</a><span>, in §3</span>
   <li><a href="#dom-animationworkletglobalscope-registeranimator">registerAnimator(name, animatorCtor)</a><span>, in §4</span>
   <li><a href="#root-element">root element</a><span>, in §3</span>
   <li><a href="#run-animators">run animators</a><span>, in §8</span>
   <li><a href="#slot-name">slot name</a><span>, in §3</span>
   <li><a href="#update-proxy-input-style-map">update proxy input style map</a><span>, in §6</span>
   <li><a href="#callbackdef-voidfunction">VoidFunction</a><span>, in §2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[css-cascade-4]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-cascade-4/#computed-value">computed value</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-typed-om-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymap">StylePropertyMap</a>
     <li><a href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly">StylePropertyMapReadOnly</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-values-3]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-values-4/#mult-zero-plus">*</a>
     <li><a href="https://drafts.csswg.org/css-values-4/#comb-comma">,</a>
     <li><a href="https://drafts.csswg.org/css-values-4/#typedef-ident">&lt;ident></a>
     <li><a href="https://drafts.csswg.org/css-values-4/#comb-one">|</a>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><a href="https://dom.spec.whatwg.org/#concept-document">document</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#window">Window</a>
    </ul>
   <li>
    <a data-link-type="biblio">[web-animations-1]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/web-animations/#documenttimeline">DocumentTimeline</a>
     <li><a href="https://w3c.github.io/web-animations/#dictdef-documenttimelineoptions">DocumentTimelineOptions</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>
     <li><a href="https://heycam.github.io/webidl/#Exposed">Exposed</a>
     <li><a href="https://heycam.github.io/webidl/#NewObject">NewObject</a>
     <li><a href="https://heycam.github.io/webidl/#SameObject">SameObject</a>
     <li><a href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>
    </ul>
   <li>
    <a data-link-type="biblio">[worklets-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.css-houdini.org/worklets/#worklet">Worklet</a>
     <li><a href="https://drafts.css-houdini.org/worklets/#workletglobalscope">WorkletGlobalScope</a>
     <li><a href="https://drafts.css-houdini.org/worklets/#worklet-global-scope-type">worklet global scope type</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-cascade-4">[CSS-CASCADE-4]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://www.w3.org/TR/css-cascade-4/">CSS Cascading and Inheritance Level 4</a>. URL: <a href="https://www.w3.org/TR/css-cascade-4/">https://www.w3.org/TR/css-cascade-4/</a>
   <dt id="biblio-css-typed-om-1">[CSS-TYPED-OM-1]
   <dd>Shane Stephens. <a href="https://www.w3.org/TR/css-typed-om-1/">CSS Typed OM Level 1</a>. URL: <a href="https://www.w3.org/TR/css-typed-om-1/">https://www.w3.org/TR/css-typed-om-1/</a>
   <dt id="biblio-css-values-3">[CSS-VALUES-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://www.w3.org/TR/css-values-3/">CSS Values and Units Module Level 3</a>. URL: <a href="https://www.w3.org/TR/css-values-3/">https://www.w3.org/TR/css-values-3/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-web-animations-1">[WEB-ANIMATIONS-1]
   <dd>Brian Birtles; et al. <a href="https://www.w3.org/TR/web-animations-1/">Web Animations</a>. URL: <a href="https://www.w3.org/TR/web-animations-1/">https://www.w3.org/TR/web-animations-1/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Cameron McCormack; Boris Zbarsky; Tobie Langel. <a href="https://www.w3.org/TR/WebIDL-1/">Web IDL</a>. URL: <a href="https://www.w3.org/TR/WebIDL-1/">https://www.w3.org/TR/WebIDL-1/</a>
   <dt id="biblio-worklets-1">[WORKLETS-1]
   <dd>Ian Kilpatrick. <a href="https://www.w3.org/TR/worklets-1/">Worklets Level 1</a>. URL: <a href="https://www.w3.org/TR/worklets-1/">https://www.w3.org/TR/worklets-1/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-explainer">[EXPLAINER]
   <dd><a href="https://github.com/WICG/animation-worklet/blob/gh-pages/README.md">Animation Worklet Explainer</a>. CR. URL: <a href="https://github.com/WICG/animation-worklet/blob/gh-pages/README.md">https://github.com/WICG/animation-worklet/blob/gh-pages/README.md</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="property-index"><span class="content">Property Index</span><a class="self-link" href="#property-index"></a></h2>
  <div class="big-element-wrapper">
   <table class="index">
    <thead>
     <tr>
      <th scope="col">Name
      <th scope="col">Value
      <th scope="col">Initial
      <th scope="col">Applies to
      <th scope="col">Inh.
      <th scope="col">%ages
      <th scope="col">Media
      <th scope="col">Ani­mat­able
      <th scope="col">Canonical order
      <th scope="col">Com­puted value
    <tbody>
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-animator-root">animator-root</a>
      <td>none | [animator name animator slot, ]* animator name animator slot
      <td>none
      <td>all elements
      <td>no
      <td>N/A
      <td>interactive
      <td>no
      <td>per grammar
      <td>as specified
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-animator">animator</a>
      <td>none | [animator name animator slot, ]* animator name animator slot
      <td>none
      <td>all elements
      <td>no
      <td>N/A
      <td>interactive
      <td>no
      <td>per grammar
      <td>as specified
   </table>
  </div>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><span class="kt"><span class="kt">interface</span></span> <a class="nv" href="#animationworklet"><span class="nv">AnimationWorklet</span></a> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject"><span class="nv">NewObject</span></a>] <span class="kt"><span class="kt">Promise</span></span>&lt;<span class="kt"><span class="kt">void</span></span>> <a class="nv" href="#dom-animationworklet-import"><span class="nv">import</span></a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><span class="kt"><span class="kt">USVString</span></span></a> <a class="nv" href="#dom-animationworklet-import-moduleurl-moduleurl"><span class="nv">moduleURL</span></a>);
};

<span class="kt"><span class="kt">partial</span></span> <span class="kt"><span class="kt">interface</span></span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/browsers.html#window"><span class="nv">Window</span></a> {
    [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject"><span class="nv">SameObject</span></a>] <span class="kt"><span class="kt">readonly</span></span> <span class="kt"><span class="kt">attribute</span></span> <a class="n" data-link-type="idl-name" href="#animationworklet"><span class="n">AnimationWorklet</span></a> <a class="nv" data-readonly="" data-type="AnimationWorklet" href="#dom-window-animationworklet"><span class="nv">animationWorklet</span></a>;
};

<span class="kt"><span class="kt">callback</span></span> <a class="nv" href="#callbackdef-voidfunction"><span class="nv">VoidFunction</span></a> = <span class="kt"><span class="kt">void</span></span> ();

[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><span class="nv">Exposed</span></a>=<span class="n"><span class="n">AnimationWorklet</span></span>]
<span class="kt"><span class="kt">interface</span></span> <a class="nv" href="#animationworkletglobalscope"><span class="nv">AnimationWorkletGlobalScope</span></a> : <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/worklets/#workletglobalscope"><span class="n">WorkletGlobalScope</span></a> {
    <span class="kt"><span class="kt">void</span></span> <a class="nv idl-code" data-link-type="method" href="#dom-animationworkletglobalscope-registeranimator"><span class="nv">registerAnimator</span></a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><span class="kt"><span class="kt">DOMString</span></span></a> <a class="nv" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-name"><span class="nv">name</span></a>, <a class="n" data-link-type="idl-name" href="#callbackdef-voidfunction"><span class="n">VoidFunction</span></a> <a class="nv" href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor"><span class="nv">animatorCtor</span></a>);
};

[
    <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><span class="nv">Exposed</span></a>=(<span class="n"><span class="n">AnimationWorklet</span></span>),
] <span class="kt"><span class="kt">interface</span></span> <a class="nv" href="#elementproxy"><span class="nv">ElementProxy</span></a> {
    <span class="kt"><span class="kt">attribute</span></span> <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly"><span class="n">StylePropertyMapReadOnly</span></a> <a class="nv" data-type="StylePropertyMapReadOnly" href="#dom-elementproxy-inputstylemap"><span class="nv">inputStyleMap</span></a>;
    <span class="kt"><span class="kt">attribute</span></span> <a class="n" data-link-type="idl-name" href="https://drafts.css-houdini.org/css-typed-om-1/#stylepropertymapreadonly"><span class="n">StylePropertyMapReadOnly</span></a> <a class="nv" data-type="StylePropertyMapReadOnly" href="#dom-elementproxy-outputstylemap"><span class="nv">outputStyleMap</span></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Todo: Should we have NoInterfaceObject/Exposed here? How do we properly represent that this
cannot be constructed via javascript?<a href="#issue-65c145a8"> ↵ </a></div>
   <div class="issue"> Give each animator instance a re-used set of AnimationTimelines instead of creating them
       specifically here and when running animations.<a href="#issue-9b16e52a"> ↵ </a></div>
   <div class="issue"> Need to add a definition for 'nearest non-visible overflow ancestor' to make sure all mentions
       stay in sync.<a href="#issue-a9c8649c"> ↵ </a></div>
   <div class="issue"> Consider giving user agents permission to skip running animator instances to throttle
    slow animators.<a href="#issue-dc52329c"> ↵ </a></div>
   <div class="issue"> Todo: Define when we may get rid of the animator.<a href="#issue-d4d8f39c"> ↵ </a></div>
   <div class="issue"> Todo: the animators output style values have the highest order in animation stack effect and
their composite operation is "replace" which is going to allow them to run independent on other
animations and in a different thread. Supporting other composite operation is not in scope at this
point.<a href="#issue-b3b90f2d"> ↵ </a></div>
   <div class="issue"> Need to decide what security considerations there are for this spec.<a href="#issue-de770110"> ↵ </a></div>
   <div class="issue"> Need to decide what privacy considerations there are for this spec.<a href="#issue-19f9ed9b"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="animation-worklet">
   <b><a href="#animation-worklet">#animation-worklet</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animation-worklet-1">1. Introduction</a> <a href="#ref-for-animation-worklet-2">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animationworklet">
   <b><a href="#animationworklet">#animationworklet</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animationworklet-1">2. Animation Worklet</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-window-animationworklet">
   <b><a href="#dom-window-animationworklet">#dom-window-animationworklet</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-window-animationworklet-1">2. Animation Worklet</a> <a href="#ref-for-dom-window-animationworklet-2">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="callbackdef-voidfunction">
   <b><a href="#callbackdef-voidfunction">#callbackdef-voidfunction</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-callbackdef-voidfunction-1">2. Animation Worklet</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animationworkletglobalscope">
   <b><a href="#animationworkletglobalscope">#animationworkletglobalscope</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animationworkletglobalscope-1">2. Animation Worklet</a>
    <li><a href="#ref-for-animationworkletglobalscope-2">4. Registering an Animator Definition</a>
    <li><a href="#ref-for-animationworkletglobalscope-3">5. Creating an Animator</a> <a href="#ref-for-animationworkletglobalscope-4">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor">
   <b><a href="#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor">#dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor-1">4. Registering an Animator Definition</a> <a href="#ref-for-dom-animationworkletglobalscope-registeranimator-name-animatorctor-animatorctor-2">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-definition">
   <b><a href="#animator-definition">#animator-definition</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-definition-1">3. Concepts</a>
    <li><a href="#ref-for-animator-definition-2">4. Registering an Animator Definition</a>
    <li><a href="#ref-for-animator-definition-3">10. CSS Animator Notation</a> <a href="#ref-for-animator-definition-4">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="class-constructor">
   <b><a href="#class-constructor">#class-constructor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-class-constructor-1">4. Registering an Animator Definition</a>
    <li><a href="#ref-for-class-constructor-2">5. Creating an Animator</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animate-function">
   <b><a href="#animate-function">#animate-function</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animate-function-1">4. Registering an Animator Definition</a>
    <li><a href="#ref-for-animate-function-2">8. Running Animators</a>
    <li><a href="#ref-for-animate-function-3">10. CSS Animator Notation</a> <a href="#ref-for-animate-function-4">(2)</a> <a href="#ref-for-animate-function-5">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-slot-list">
   <b><a href="#animator-slot-list">#animator-slot-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-slot-list-1">3. Concepts</a>
    <li><a href="#ref-for-animator-slot-list-2">6. Creating an Element Proxy</a>
    <li><a href="#ref-for-animator-slot-list-3">7.2. Change in an element’s computed style</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-timeline-options-list">
   <b><a href="#animator-timeline-options-list">#animator-timeline-options-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-timeline-options-list-1">4. Registering an Animator Definition</a>
    <li><a href="#ref-for-animator-timeline-options-list-2">7.3. Animator specifies a DocumentTimeline</a>
    <li><a href="#ref-for-animator-timeline-options-list-3">7.4. Animator specifies a ScrollTimeline</a> <a href="#ref-for-animator-timeline-options-list-4">(2)</a>
    <li><a href="#ref-for-animator-timeline-options-list-5">8. Running Animators</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-slot">
   <b><a href="#animator-slot">#animator-slot</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-slot-1">3. Concepts</a>
    <li><a href="#ref-for-animator-slot-2">10. CSS Animator Notation</a> <a href="#ref-for-animator-slot-3">(2)</a> <a href="#ref-for-animator-slot-4">(3)</a> <a href="#ref-for-animator-slot-5">(4)</a> <a href="#ref-for-animator-slot-6">(5)</a> <a href="#ref-for-animator-slot-7">(6)</a> <a href="#ref-for-animator-slot-8">(7)</a> <a href="#ref-for-animator-slot-9">(8)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-input-property-list">
   <b><a href="#animator-input-property-list">#animator-input-property-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-input-property-list-1">6. Creating an Element Proxy</a>
    <li><a href="#ref-for-animator-input-property-list-2">7.2. Change in an element’s computed style</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-output-property-list">
   <b><a href="#animator-output-property-list">#animator-output-property-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-output-property-list-1">6. Creating an Element Proxy</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-instance">
   <b><a href="#animator-instance">#animator-instance</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-instance-1">3. Concepts</a> <a href="#ref-for-animator-instance-2">(2)</a>
    <li><a href="#ref-for-animator-instance-3">5. Creating an Animator</a> <a href="#ref-for-animator-instance-4">(2)</a> <a href="#ref-for-animator-instance-5">(3)</a>
    <li><a href="#ref-for-animator-instance-6">6. Creating an Element Proxy</a> <a href="#ref-for-animator-instance-7">(2)</a> <a href="#ref-for-animator-instance-8">(3)</a>
    <li><a href="#ref-for-animator-instance-9">7. Requesting Animation Frames</a>
    <li><a href="#ref-for-animator-instance-10">7.1. Element proxy creation/removal</a> <a href="#ref-for-animator-instance-11">(2)</a>
    <li><a href="#ref-for-animator-instance-12">8. Running Animators</a>
    <li><a href="#ref-for-animator-instance-13">10. CSS Animator Notation</a> <a href="#ref-for-animator-instance-14">(2)</a> <a href="#ref-for-animator-instance-15">(3)</a> <a href="#ref-for-animator-instance-16">(4)</a> <a href="#ref-for-animator-instance-17">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-name">
   <b><a href="#animator-name">#animator-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-name-1">4. Registering an Animator Definition</a>
    <li><a href="#ref-for-animator-name-2">5. Creating an Animator</a>
    <li><a href="#ref-for-animator-name-3">10. CSS Animator Notation</a> <a href="#ref-for-animator-name-4">(2)</a> <a href="#ref-for-animator-name-5">(3)</a> <a href="#ref-for-animator-name-6">(4)</a> <a href="#ref-for-animator-name-7">(5)</a> <a href="#ref-for-animator-name-8">(6)</a> <a href="#ref-for-animator-name-9">(7)</a> <a href="#ref-for-animator-name-10">(8)</a> <a href="#ref-for-animator-name-11">(9)</a> <a href="#ref-for-animator-name-12">(10)</a> <a href="#ref-for-animator-name-13">(11)</a> <a href="#ref-for-animator-name-14">(12)</a> <a href="#ref-for-animator-name-15">(13)</a> <a href="#ref-for-animator-name-16">(14)</a> <a href="#ref-for-animator-name-17">(15)</a> <a href="#ref-for-animator-name-18">(16)</a> <a href="#ref-for-animator-name-19">(17)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="root-element">
   <b><a href="#root-element">#root-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-root-element-1">7.4. Animator specifies a ScrollTimeline</a> <a href="#ref-for-root-element-2">(2)</a>
    <li><a href="#ref-for-root-element-3">10. CSS Animator Notation</a> <a href="#ref-for-root-element-4">(2)</a> <a href="#ref-for-root-element-5">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-proxy-map">
   <b><a href="#element-proxy-map">#element-proxy-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-proxy-map-1">4. Registering an Animator Definition</a>
    <li><a href="#ref-for-element-proxy-map-2">8. Running Animators</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="element-proxy">
   <b><a href="#element-proxy">#element-proxy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element-proxy-1">3. Concepts</a>
    <li><a href="#ref-for-element-proxy-2">6. Creating an Element Proxy</a> <a href="#ref-for-element-proxy-3">(2)</a>
    <li><a href="#ref-for-element-proxy-4">7.2. Change in an element’s computed style</a> <a href="#ref-for-element-proxy-5">(2)</a>
    <li><a href="#ref-for-element-proxy-6">10. CSS Animator Notation</a> <a href="#ref-for-element-proxy-7">(2)</a> <a href="#ref-for-element-proxy-8">(3)</a> <a href="#ref-for-element-proxy-9">(4)</a> <a href="#ref-for-element-proxy-10">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="proxied-element">
   <b><a href="#proxied-element">#proxied-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-proxied-element-1">6. Creating an Element Proxy</a> <a href="#ref-for-proxied-element-2">(2)</a> <a href="#ref-for-proxied-element-3">(3)</a> <a href="#ref-for-proxied-element-4">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animator-name-to-animator-definition-map">
   <b><a href="#animator-name-to-animator-definition-map">#animator-name-to-animator-definition-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animator-name-to-animator-definition-map-1">4. Registering an Animator Definition</a> <a href="#ref-for-animator-name-to-animator-definition-map-2">(2)</a>
    <li><a href="#ref-for-animator-name-to-animator-definition-map-3">5. Creating an Animator</a>
    <li><a href="#ref-for-animator-name-to-animator-definition-map-4">6. Creating an Element Proxy</a>
    <li><a href="#ref-for-animator-name-to-animator-definition-map-5">7.2. Change in an element’s computed style</a>
    <li><a href="#ref-for-animator-name-to-animator-definition-map-6">8. Running Animators</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-animationworkletglobalscope-registeranimator">
   <b><a href="#dom-animationworkletglobalscope-registeranimator">#dom-animationworkletglobalscope-registeranimator</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-animationworkletglobalscope-registeranimator-1">2. Animation Worklet</a>
    <li><a href="#ref-for-dom-animationworkletglobalscope-registeranimator-2">4. Registering an Animator Definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parsing-an-animator-slot-list">
   <b><a href="#parsing-an-animator-slot-list">#parsing-an-animator-slot-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parsing-an-animator-slot-list-1">4. Registering an Animator Definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parsing-an-animator-property-list">
   <b><a href="#parsing-an-animator-property-list">#parsing-an-animator-property-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parsing-an-animator-property-list-1">4. Registering an Animator Definition</a> <a href="#ref-for-parsing-an-animator-property-list-2">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="parsing-an-animator-timeline-options-list">
   <b><a href="#parsing-an-animator-timeline-options-list">#parsing-an-animator-timeline-options-list</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parsing-an-animator-timeline-options-list-1">4. Registering an Animator Definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="-animator-name-root-element-to-instance-map">
   <b><a href="#-animator-name-root-element-to-instance-map">#-animator-name-root-element-to-instance-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for--animator-name-root-element-to-instance-map-1">5. Creating an Animator</a>
    <li><a href="#ref-for--animator-name-root-element-to-instance-map-2">8. Running Animators</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-new-animator-instance">
   <b><a href="#create-a-new-animator-instance">#create-a-new-animator-instance</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-new-animator-instance-1">8. Running Animators</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="elementproxy">
   <b><a href="#elementproxy">#elementproxy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-elementproxy-1">6. Creating an Element Proxy</a> <a href="#ref-for-elementproxy-2">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-elementproxy-outputstylemap">
   <b><a href="#dom-elementproxy-outputstylemap">#dom-elementproxy-outputstylemap</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-elementproxy-outputstylemap-1">6. Creating an Element Proxy</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="update-proxy-input-style-map">
   <b><a href="#update-proxy-input-style-map">#update-proxy-input-style-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-update-proxy-input-style-map-1">6. Creating an Element Proxy</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="animation-requested-flag">
   <b><a href="#animation-requested-flag">#animation-requested-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-animation-requested-flag-1">3. Concepts</a>
    <li><a href="#ref-for-animation-requested-flag-2">5. Creating an Animator</a>
    <li><a href="#ref-for-animation-requested-flag-3">7. Requesting Animation Frames</a> <a href="#ref-for-animation-requested-flag-4">(2)</a>
    <li><a href="#ref-for-animation-requested-flag-5">7.1. Element proxy creation/removal</a>
    <li><a href="#ref-for-animation-requested-flag-6">7.2. Change in an element’s computed style</a>
    <li><a href="#ref-for-animation-requested-flag-7">7.3. Animator specifies a DocumentTimeline</a>
    <li><a href="#ref-for-animation-requested-flag-8">7.4. Animator specifies a ScrollTimeline</a>
    <li><a href="#ref-for-animation-requested-flag-9">8. Running Animators</a> <a href="#ref-for-animation-requested-flag-10">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="frame-requested">
   <b><a href="#frame-requested">#frame-requested</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-frame-requested-1">7. Requesting Animation Frames</a>
    <li><a href="#ref-for-frame-requested-2">7.1. Element proxy creation/removal</a>
    <li><a href="#ref-for-frame-requested-3">7.2. Change in an element’s computed style</a>
    <li><a href="#ref-for-frame-requested-4">7.3. Animator specifies a DocumentTimeline</a>
    <li><a href="#ref-for-frame-requested-5">7.4. Animator specifies a ScrollTimeline</a>
    <li><a href="#ref-for-frame-requested-6">8. Running Animators</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="frame-current">
   <b><a href="#frame-current">#frame-current</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-frame-current-1">5. Creating an Animator</a>
    <li><a href="#ref-for-frame-current-2">7. Requesting Animation Frames</a> <a href="#ref-for-frame-current-3">(2)</a>
    <li><a href="#ref-for-frame-current-4">8. Running Animators</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="run-animators">
   <b><a href="#run-animators">#run-animators</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-run-animators-1">8. Running Animators</a> <a href="#ref-for-run-animators-2">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="propdef-animator-root">
   <b><a href="#propdef-animator-root">#propdef-animator-root</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-animator-root-1">6. Creating an Element Proxy</a>
    <li><a href="#ref-for-propdef-animator-root-2">10. CSS Animator Notation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="propdef-animator">
   <b><a href="#propdef-animator">#propdef-animator</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-animator-1">6. Creating an Element Proxy</a>
    <li><a href="#ref-for-propdef-animator-2">10. CSS Animator Notation</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>